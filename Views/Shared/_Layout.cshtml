@using Microsoft.AspNetCore.Http

<!DOCTYPE html>
<html lang="vi">

<head>
    <link href="~/css/site.css" rel="stylesheet" />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="~/css/site.css" />
</head>

<body>
    @await Html.PartialAsync("_LoginRegisterModal")

    <!-- Header va Menu -->
    <nav class="navbar navbar-expand-lg navbar-dark modern-navbar">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold fs-4" href="/">
                <i class="bi bi-globe2"></i> IT THÍCH DU LỊCH
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainMenu"
                    aria-controls="mainMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainMenu">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0 fw-semibold align-items-center">

                    @{
                        var userType = Context.Session.GetString("UserType");
                        string displayType = "";
                        string badgeClass = "bg-secondary ms-2";
                        switch (userType)
                        {
                            case "Customer":
                                displayType = "Khách thường";
                                badgeClass = "bg-info text-dark ms-2";
                                break;
                            case "VIP":
                                displayType = "Khách VIP";
                                badgeClass = "bg-warning text-dark ms-2";
                                break;
                            case "Admin":
                                displayType = "Quản trị viên";
                                badgeClass = "bg-danger ms-2";
                                break;
                        }
                    }

                    @if (Context.Session.GetInt32("UserId") != null)
                    {
                        if (userType == "Admin")
                        {
                            <!-- MENU DROPDOWN ADMIN -->
                            <li class="nav-item dropdown me-2">
                                <a class="btn btn-danger fw-bold px-3 dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-gear-fill"></i> Quản Trị
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li>
                                        <a class="dropdown-item" href="/AdminTour/User">
                                            <i class="bi bi-people-fill me-2"></i>Quản Lý User
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="/AdminTour/">
                                            <i class="bi bi-card-checklist me-2"></i>Quản Lý Tour
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="/AdminTour/ManageBooking">
                                            <i class="bi bi-clipboard-check me-2"></i>Quản Lí Đơn Đặt Tour
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item" href="/AdminTour/Create">
                                            <i class="bi bi-plus-circle me-2"></i>Tạo Tour Mới
                                        </a>
                                    </li>
                                </ul>
                            </li>
                        }
                        else
                        {
                            <!-- DANH MUC DROPDOWN MENU -->
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle active" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-list-ul"></i> Danh mục
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="/Tours?category=MienBac">
                                        <i class="bi bi-mountain text-success"></i> Tour Miền Bắc
                                    </a></li>
                                    <li><a class="dropdown-item" href="/Tours?category=MienTrung">
                                        <i class="bi bi-building text-warning"></i> Tour Miền Trung
                                    </a></li>
                                    <li><a class="dropdown-item" href="/Tours?category=MienNam">
                                        <i class="bi bi-water text-info"></i> Tour Miền Nam
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="/Tours?category=ChauA">
                                        <i class="bi bi-globe-asia-australia text-primary"></i> Tour Du Lịch Châu Á
                                    </a></li>
                                    <li><a class="dropdown-item" href="/Tours?category=AuUcMyPhi">
                                        <i class="bi bi-airplane text-danger"></i> Tour Du Lịch Âu-Úc-Mỹ-Phi
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="/">
                                        <i class="bi bi-house-door"></i> Tất cả tour
                                    </a></li>
                                </ul>
                            </li>
                            @if (userType != "Admin")
                            {
                                <li class="nav-item"><a class="nav-link" href="/Booking/MyBookings">Tour đã đặt</a></li>
                                @if (userType == "VIP")
                                {
                                    <li class="nav-item"><a class="nav-link" href="#">Tour đã đăng</a></li>
                                }
                                else
                                {
                                    <li class="nav-item"><a class="nav-link" href="#">Đăng ký VIP</a></li>
                                }
                                <li class="nav-item"><a class="nav-link" href="https://fb.com/Trongg2005" target="_blank">Liên hệ</a></li>
                            }
                            if (userType == "VIP")
                            {
                                <li class="nav-item me-2">
                                    <a class="btn btn-warning fw-bold text-dark px-3" href="/AdminTour/Create">
                                        <i class="bi bi-plus-circle"></i> Tạo Tour
                                    </a>
                                </li>
                            }
                        }
                        <li class="nav-item d-flex align-items-center ms-3">
                            @if (!string.IsNullOrEmpty(displayType))
                            {
                                @if (userType == "VIP")
                                {
                                    <div class="luxury-card vip-card me-3">
                                        <span class="plane-icon">✈️</span>
                                        <span class="greeting-text">Chào quý khách</span>
                                        <span class="customer-name">@Context.Session.GetString("UserName")</span>
                                        <span class="exclamation">!</span>
                                        <span class="diamond-icon">💎</span>
                                        <span class="vip-text">Khách VIP</span>
                                        <div class="luxury-sparkles">
                                            <div class="sparkle sparkle-1">✨</div>
                                            <div class="sparkle sparkle-2">⭐</div>
                                            <div class="sparkle sparkle-3">💫</div>
                                        </div>
                                    </div>
                                }
                                else if (userType == "Admin")
                                {
                                    <div class="luxury-card admin-card me-3">
                                        <span class="jet-icon">🛩️</span>
                                        <span class="greeting-text">Weo com</span>
                                        <span class="customer-name">@Context.Session.GetString("UserName")</span>
                                        <span class="exclamation">!</span>
                                        <span class="crown-icon">👑</span>
                                        <span class="admin-text">Quản Trị Viên</span>
                                        <div class="luxury-effects">
                                            <div class="effect effect-1">⚡</div>
                                            <div class="effect effect-2">🔥</div>
                                            <div class="effect effect-3">💎</div>
                                            <div class="effect effect-4">🌟</div>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="luxury-card normal-card me-3">
                                        <span class="plane-icon">✈️</span>
                                        <span class="greeting-text">Chào quý khách</span>
                                        <span class="customer-name">@Context.Session.GetString("UserName")</span>
                                        <span class="exclamation">!</span>
                                        <span class="normal-text">@displayType</span>
                                    </div>
                                }
                            }
                        </li>
                        <li class="nav-item">
                            <form method="post" asp-controller="Account" asp-action="Logout" class="m-0">
                                <button type="submit" class="btn-logout-separate">
                                    <i class="bi bi-box-arrow-right me-1"></i>
                                    Đăng xuất
                                </button>
                            </form>
                        </li>
                    }
                    else
                    {
                        <li class="nav-item ms-3">
                            <a href="#" class="btn btn-warning fw-bold" data-bs-toggle="modal" data-bs-target="#loginRegisterModal">Đăng nhập</a>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid p-0">
        @RenderBody()
    </div>

    <footer class="bg-white border-top mt-5 py-3">
        <div class="container text-center small text-secondary">
            © 2025 TourBooking. ĐỒ ÁN CƠ SỞ - CÔNG NGHỆ THÔNG TIN K22
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    @* Script để tự động mở modal sau khi đăng ký thành công *@
    @if (TempData["ShowLoginModal"] != null)
    {
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Mở modal đăng nhập
                var loginModal = new bootstrap.Modal(document.getElementById('loginRegisterModal'));
                loginModal.show();

                @if (TempData["ActiveTab"] == "login")
                {
                    <text>
                    // Chuyển sang tab đăng nhập
                    setTimeout(function() {
                        var loginTab = document.getElementById('login-tab');
                        if (loginTab) {
                            loginTab.click();
                        }
                    }, 100);
                    </text>
                }
                else if (TempData["ActiveTab"] == "register")
                {
                    <text>
                    // Chuyển sang tab đăng ký
                    setTimeout(function() {
                        var registerTab = document.getElementById('register-tab');
                        if (registerTab) {
                            registerTab.click();
                        }
                    }, 100);
                    </text>
                }
            });
        </script>
    }

    @RenderSection("Scripts", required: false)
</body>

</html>
